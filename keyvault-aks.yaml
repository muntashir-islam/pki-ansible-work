- name: grab test-secret from azure kv
  hosts: localhost
  gather_facts: false
  collections:
    - azure.azcollection
  vars:
    kv_secret_name: "test"
  tasks:
    - name: set facts
      set_fact:
        az_vault_name: "kv-stage-medstack-pki"


    - name: Get secret from Azure Key Vault
      azure.azcollection.azure_rm_keyvaultsecret:
        name: "{{ kv_secret_name }}"
        vault_uri: "{{ lookup('env', 'AZ_VAULT_URL') }}"
        client_id: "{{ lookup('env', 'AZ_CLIENT_ID') }}"
        client_secret: "{{ lookup('env', 'AZ_CLIENT_SECRET') }}"
        tenant: "{{ lookup('env', 'AZ_TENANT_ID') }}"
      register: secret_output
    - name: Display the secret
      debug:
        msg: "{{ secret_output.secret }}"